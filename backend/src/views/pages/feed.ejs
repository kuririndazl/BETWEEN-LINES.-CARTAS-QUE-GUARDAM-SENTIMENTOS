<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed</title>
    <%- include('../partials/head.ejs') %>
</head>

<body>
    <%- include('../partials/header.ejs') %>

        <main class="main-content">
            <div class="feed-layout">
                <section class="feed-posts">

                    <% if (message) { %>
                        <div class="message-box success-message" style="margin-bottom: 20px;"><%= message %></div>
                    <% } %>

                    <% if (posts.length === 0) { %>
                        <div class="post-card" style="text-align: center; padding: 40px; color: #8E8E8E;">
                            <i class="fas fa-inbox" style="font-size: 50px; margin-bottom: 15px;"></i>
                            <p>Nenhuma carta pública ainda. Seja o primeiro a escrever!</p>
                        </div>
                    <% } %>
                    
                    <% posts.forEach(function(post) { %>
                        <div class="post-card">
                            <div class="post-header">
                                <img src="<%= post.profilePictureUrl || '/public/images/default_avatar.png' %>" alt="<%= post.username %>">
                                <span><%= post.username %></span>
                            </div>
                            <div class="post-content">
                                <% if (post.imageUrl) { %>
                                    <img class="post-image" src="<%= post.imageUrl %>" alt="Imagem da carta">
                                <% } else { %>
                                    <i class="fas fa-feather-alt" style="font-size: 80px; color: #DBDBDB;"></i>
                                <% } %>
                            </div>
                            <div class="post-actions">
                                <button><i class="far fa-heart"></i></button>
                                <button><i class="far fa-comment"></i></button>
                                <button><i class="far fa-paper-plane"></i></button>
                            </div>
                            <div class="post-caption">
                                <strong><%= post.username %></strong> 
                                
                                <% if (post.title) { %>
                                    <p style="font-weight: 600; margin-top: 5px;">*<%= post.title %>*</p>
                                <% } %>
                                
                                <pre style="white-space: pre-wrap; font-family: inherit;"><%= post.content %></pre> 
                                
                                <small style="color: #8E8E8E; display: block; margin-top: 10px;">Enviado em <%= new Date(post.creationDate).toLocaleDateString('pt-BR', { day: 'numeric', month: 'short' }) %></small>
                            </div>
                        </div>
                    <% }); %>
                    
                    </section>

                <aside class="sidebar">
                    <div class="user-suggestion-card" style="margin-bottom: 30px;">
                        <img src="<%= user.profilePictureUrl %>" alt="Seu Perfil">
                        <div class="user-info">
                            <a href="/profile" class="username">
                                <%= user.username %>
                            </a>
                            <div class="subtitle">Meu Perfil</div>
                        </div>
                    </div>

                    <div class="subtitle" style="font-weight: 600; color: #8E8E8E; margin-bottom: 15px;">Sugestões para Você</div>

                    <div class="user-suggestion-card">
                        <img src="/public/img/escritor_icon.jpeg" alt="Manin_macabro">
                        <div class="user-info">
                            <div class="username">Manin_macabro</div>
                            <div class="subtitle">Escritor</div>
                        </div>
                        <a href="#" class="follow" style="font-size: 12px; font-weight: 600;">Seguir</a>
                    </div>

                    <div class="user-suggestion-card">
                        <img src="/public/img/colecionador_icon.jpeg" alt="Selos Antigos">
                        <div class="user-info">
                            <div class="username">colecionador_selos</div>
                            <div class="subtitle">Colecionador</div>
                        </div>
                        <a href="#" class="follow"  style="font-size: 12px; font-weight: 600;">Seguir</a>
                    </div>

                    <a href="/new-letter" class="write-letter-btn">
                        <i class="fas fa-feather-alt"></i> Escrever Nova Carta
                    </a>
                </aside>
            </div>
        </main>

        <%- include('../partials/footer.ejs') %>
</body>
</html>